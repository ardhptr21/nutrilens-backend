================================================================================
                    POSTMAN TESTING GUIDE - NUTRILENS BACKEND
================================================================================

Base URL: http://localhost:8080

================================================================================
                              TESTING FLOW LENGKAP
================================================================================

STEP 1: HEALTH CHECK
====================
Method: GET
URL: http://localhost:8080/health-check
Headers: -
Body: Kosong

Response (200 OK):
{
  "success": true,
  "message": "Service is healthy",
  "responseObject": null,
  "statusCode": 200
}

================================================================================

STEP 2: REGISTER USER
====================
Method: POST
URL: http://localhost:8080/auth/register
Headers: Content-Type: application/json

Body:
{
  "name": "Test User",
  "email": "test@example.com",
  "password": "password123"
}

Response (201 Created):
{
  "success": true,
  "message": "User registered successfully",
  "responseObject": {
    "id": "cxyz123abc",
    "name": "Test User",
    "email": "test@example.com",
    "createdAt": "2025-12-01T10:00:00Z",
    "updatedAt": "2025-12-01T10:00:00Z"
  },
  "statusCode": 201
}

================================================================================

STEP 3: LOGIN & COPY TOKEN
===========================
Method: POST
URL: http://localhost:8080/auth/login
Headers: Content-Type: application/json

Body:
{
  "email": "test@example.com",
  "password": "password123"
}

Response (200 OK):
{
  "success": true,
  "message": "Login successful",
  "responseObject": {
    "user": {
      "id": "cxyz123abc",
      "name": "Test User",
      "email": "test@example.com"
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "statusCode": 200
}

⭐ COPY TOKEN INI! Akan digunakan untuk step berikutnya.
Token disimpan di variable Postman atau di copy manual di setiap request.

================================================================================

STEP 4: GET USER PREFERENCE (OPTIONAL)
=======================================
Method: GET
URL: http://localhost:8080/users/me/preference
Headers:
  Authorization: Bearer <TOKEN>
  Content-Type: application/json
Body: Kosong

Response (200 OK):
{
  "success": true,
  "message": "Preference retrieved successfully",
  "responseObject": {
    "id": "pref-123",
    "userId": "cxyz123abc",
    "targetCal": 2500,
    "targetFat": 70,
    "targetCarbs": 275,
    "targetProtein": 50,
    "createdAt": "2025-12-01T10:00:00Z",
    "updatedAt": "2025-12-01T10:00:00Z"
  },
  "statusCode": 200
}

================================================================================

STEP 5: CREATE MEAL PERTAMA (DENGAN IMAGE UPLOAD)
================================================
Method: POST
URL: http://localhost:8080/nutritions/meals
Headers:
  Authorization: Bearer <TOKEN>
  Content-Type: multipart/form-data

Body (Form-Data):
  - Key: "name" → Value: "Nasi Goreng"
  - Key: "cal" → Value: "450"
  - Key: "fat" → Value: "15"
  - Key: "protein" → Value: "12"
  - Key: "carbs" → Value: "65"
  - Key: "description" → Value: "Nasi goreng dengan telur dan sayuran"
  - Key: "image" → Value: [Pilih file gambar JPEG/PNG, max 5MB]

Response (201 Created):
{
  "success": true,
  "message": "Meal with image created successfully",
  "responseObject": {
    "id": "meal-123",
    "nutritionId": "nutrition-456",
    "name": "Nasi Goreng",
    "image": "/uploads/meals/userid/1701432000-nasi-goreng.jpg",
    "description": "Nasi goreng dengan telur dan sayuran",
    "cal": 450,
    "fat": 15,
    "protein": 12,
    "carbs": 65,
    "createdAt": "2025-12-01T10:00:00Z"
  },
  "statusCode": 201
}

⭐ Otomatis membuat Nutrition record untuk hari ini jika belum ada!
⭐ Upload gambar langsung! Path disimpan ke database.
⭐ Format: /uploads/meals/{userid}/{timestamp}-{filename}

================================================================================

STEP 6: CREATE MEAL KEDUA (HARI YANG SAMA, AUTO DITAMBAH)
=========================================================
Method: POST
URL: http://localhost:8080/nutritions/meals
Headers:
  Authorization: Bearer <TOKEN>
  Content-Type: multipart/form-data

Body (Form-Data):
  - Key: "name" → Value: "Ayam Bakar"
  - Key: "cal" → Value: "350"
  - Key: "fat" → Value: "20"
  - Key: "protein" → Value: "40"
  - Key: "carbs" → Value: "5"
  - Key: "description" → Value: "Ayam bakar tanpa minyak"
  - Key: "image" → Value: [Pilih file gambar JPEG/PNG, max 5MB]

Response (201 Created):
{
  "success": true,
  "message": "Meal with image created successfully",
  "responseObject": {
    "id": "meal-124",
    "nutritionId": "nutrition-456",
    "name": "Ayam Bakar",
    "image": "/uploads/meals/userid/1701432001-ayam-bakar.jpg",
    "description": "Ayam bakar tanpa minyak",
    "cal": 350,
    "fat": 20,
    "protein": 40,
    "carbs": 5,
    "createdAt": "2025-12-01T10:30:00Z"
  },
  "statusCode": 201
}

⭐ Otomatis ditambahkan ke Nutrition record yang sama untuk hari ini!

================================================================================

STEP 7: GET NUTRITION STATISTICS (DETAIL PER TANGGAL)
====================================================
Method: GET
URL: http://localhost:8080/nutritions/2025-12-01
Headers:
  Authorization: Bearer <TOKEN>
  Content-Type: application/json
Body: Kosong

Format Date Parameter: YYYY-MM-DD
Contoh: 2025-12-01, 2025-11-30, dll

Response (200 OK) - FORMAT SESUAI SCHEMA PRISMA:
{
  "success": true,
  "message": "Nutrition statistics retrieved",
  "responseObject": {
    "id": "nutrition-456",
    "logAt": "2025-12-01T00:00:00.000Z",
    "cal": 800,                 ← Total cal dari 2 meals (450 + 350)
    "fat": 35,                  ← Total fat (15 + 20)
    "protein": 52,              ← Total protein (12 + 40)
    "carbs": 70,                ← Total carbs (65 + 5)
    "targetCal": 2500,          ← Target dari user preference
    "targetFat": 70,
    "targetCarbs": 275,
    "targetProtein": 50,
    "meals": [
      {
        "id": "meal-123",
        "name": "Nasi Goreng",
        "image": "https://example.com/nasi-goreng.jpg",
        "description": "Nasi goreng dengan telur dan sayuran",
        "cal": 450,
        "fat": 15,
        "protein": 12,
        "carbs": 65,
        "createdAt": "2025-12-01T10:00:00Z"
      },
      {
        "id": "meal-124",
        "name": "Ayam Bakar",
        "image": "https://example.com/ayam-bakar.jpg",
        "description": "Ayam bakar tanpa minyak",
        "cal": 350,
        "fat": 20,
        "protein": 40,
        "carbs": 5,
        "createdAt": "2025-12-01T10:30:00Z"
      }
    ]
  },
  "statusCode": 200
}

Menampilkan statistik dan detail semua meals untuk tanggal tersebut!

================================================================================

STEP 8 (OPTIONAL): SCAN FOOD FROM IMAGE (AI)
==============================================
Method: POST
URL: http://localhost:8080/nutritions/scan
Headers:
  Authorization: Bearer <TOKEN>
  Content-Type: multipart/form-data

Body (Form-Data):
  - Key: "image" → Value: [Pilih file gambar makanan JPEG/PNG, max 5MB]
  - Key: "detail" → Value: "optional description" (opsional)

Response (200 OK):
{
  "success": true,
  "message": "Nutrition data retrieved",
  "responseObject": {
    "name": "Soto Ayam",
    "cal": 280,
    "fat": 12,
    "protein": 18,
    "carbs": 25
  },
  "statusCode": 200
}

⭐ Hanya mengembalikan nutrisi dari AI, tidak disimpan otomatis.
Anda bisa copy-paste nilai ke Step 5 untuk membuat meal.

================================================================================
                              TESTING IMAGE FIELD
================================================================================

TESTING STEP: Verifikasi Image Field pada Meals
=================================================

Setelah menjalankan Step 5 & 6 (Create Meal), ikuti langkah berikut untuk 
memverifikasi bahwa image field telah berhasil ditambahkan ke database:

1. JALANKAN STEP 5 & 6 (Create Meal dengan image)
   - Pastikan body request include field "image"
   - Perhatikan di response: image field harus ada di responseObject
   Contoh response dari Step 5:
   {
     "success": true,
     "message": "Meal created successfully",
     "responseObject": {
       "id": "meal-123",
       "nutritionId": "nutrition-456",
       "name": "Nasi Goreng",
       "image": "https://example.com/nasi-goreng.jpg",    ← IMAGE FIELD INI!
       "description": "Nasi goreng dengan telur dan sayuran",
       ...
     }
   }

2. JALANKAN STEP 7 (Get Nutrition Statistics)
   - Method: GET
   - URL: http://localhost:8080/nutritions/2025-12-01 (gunakan tanggal hari ini)
   - Headers: Authorization: Bearer <TOKEN>
   
   Perhatikan di response dalam array "meals", setiap meal harus memiliki 
   field "image":
   
   {
     "success": true,
     "message": "Nutrition statistics retrieved",
     "responseObject": {
       "id": "nutrition-456",
       "logAt": "2025-12-01T00:00:00.000Z",
       "meals": [
         {
           "id": "meal-123",
           "name": "Nasi Goreng",
           "image": "https://example.com/nasi-goreng.jpg",  ← IMAGE FIELD INI!
           "description": "Nasi goreng dengan telur dan sayuran",
           "cal": 450,
           ...
         }
       ]
     }
   }

3. JIKA IMAGE FIELD TERLIHAT DI RESPONSE:
   ✅ Image field berhasil ditambahkan ke database!
   ✅ Meal model sudah ter-update dengan image property
   ✅ Prisma client sudah ter-generate dengan benar
   
   Tips: Buka database management tool (pgAdmin, DBeaver, atau Prisma Studio)
   dan periksa tabel "meals" - seharusnya ada kolom "image" baru.

4. JIKA IMAGE FIELD TIDAK TERLIHAT:
   ❌ Kemungkinan Prisma client belum di-regenerate
   ❌ Solusi: Jalankan command: pnpm exec prisma generate
   ❌ Atau jalankan migration: pnpm exec prisma migrate dev

TESTING IMAGE FIELD DENGAN BERBAGAI FORMAT:
=============================================

A. URL String (Recommended for testing):
   "image": "https://example.com/food.jpg"
   "image": "https://media.example.com/meals/nasi-goreng.png"

B. Local Path:
   "image": "/uploads/meals/2025-12-01/meal-123.jpg"

C. Base64 Encoded (untuk future implementation):
   "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEA..."

D. Null/Empty (Optional field):
   "image": null
   atau tidak include field sama sekali

TESTING SCENARIO:
=================

TEST 1: Create Meal with Image URL
   Method: POST
   URL: http://localhost:8080/nutritions/meals
   Body: 
   {
     "name": "Burger Ayam",
     "image": "https://cdn-icons-png.flaticon.com/512/3729/3729412.png",
     "cal": 550,
     "fat": 25,
     "protein": 35,
     "carbs": 45
   }
   Expected: Response includes image field ✅

TEST 2: Create Meal without Image (Optional)
   Method: POST
   URL: http://localhost:8080/nutritions/meals
   Body: 
   {
     "name": "Salad Sayuran",
     "cal": 150,
     "fat": 5,
     "protein": 8,
     "carbs": 20
   }
   Expected: Response includes image field (null) atau tidak ada field ✅

TEST 3: Get Statistics - Verify all meals have image field
   Method: GET
   URL: http://localhost:8080/nutritions/2025-12-01
   Expected: Semua meals di array "meals" include image field ✅

VERIFICATION CHECKLIST:
=======================
[ ] Image field muncul di response Step 5 (Create Meal 1)
[ ] Image field muncul di response Step 6 (Create Meal 2)
[ ] Image field muncul di GET Statistics response
[ ] Setiap meal di array "meals" memiliki field "image"
[ ] Image value sesuai dengan yang dikirim di request body
[ ] Jika tidak ada image di request, field image tetap ada (null atau empty)
[ ] Database table "meals" memiliki kolom "image" baru

================================================================================
                              CHECKLIST TESTING
================================================================================

[ ] 1. Health Check: GET http://localhost:8080/health-check
[ ] 2. Register: POST http://localhost:8080/auth/register + body
[ ] 3. Login: POST http://localhost:8080/auth/login + body → COPY TOKEN
[ ] 4. Get Preference: GET http://localhost:8080/users/me/preference + auth
[ ] 5. Create Meal 1 (with image): POST http://localhost:8080/nutritions/meals + form-data + auth
[ ] 6. Create Meal 2 (with image): POST http://localhost:8080/nutritions/meals + form-data + auth
[ ] 7. Get Statistics: GET http://localhost:8080/nutritions/2025-12-01 + auth
[ ] 8 (Optional). Scan Image: POST http://localhost:8080/nutritions/scan + file + auth

================================================================================
                            POSTMAN SETUP TIPS
================================================================================

OPTION 1: MENGGUNAKAN ENVIRONMENT VARIABLE
===========================================
1. Di response Step 3 (Login), copy value "accessToken"
2. Di Postman, buka tab "Environments" (atau Ctrl+Shift+E)
3. Buat environment baru atau use yang sudah ada
4. Tambah variable: 
   - Variable name: token
   - Initial value: <paste_token_dari_response>
   - Current value: <paste_token_dari_response>
5. Save environment
6. Di setiap request yang perlu auth, gunakan header:
   Authorization: Bearer {{token}}
7. Otomatis Postman akan replace {{token}} dengan nilai variable

OPTION 2: MANUAL COPY-PASTE SETIAP REQUEST
===========================================
1. Copy token dari response Step 3
2. Di setiap request dengan auth, replace <TOKEN> dengan token yang di-copy
3. Contoh: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

================================================================================
                            IMPORTANT NOTES
================================================================================

✓ Endpoint /nutritions/meals membuat meal dan otomatis detect hari hari ini
✓ Endpoint /nutritions/:date mengambil statistik nutrisi untuk tanggal tertentu
✓ Semua nama field di response mengikuti schema Prisma
✓ Field yang ada: id, logAt, cal, fat, protein, carbs, targetCal, targetFat, 
  targetCarbs, targetProtein, meals (dengan image)
✓ Data cal, fat, protein, carbs adalah TOTAL dari semua meals di hari itu
✓ targetCal, targetFat, etc adalah dari user preference
✓ Format date di parameter: YYYY-MM-DD
✓ Format date di response: ISO 8601 (2025-12-01T00:00:00.000Z)
✓ Semua request di-filter berdasarkan user yang login (req.user.id)
✓ Maksimal file gambar (scan): 5MB, format: JPEG atau PNG
✓ Field "description" di create meal adalah optional
✓ NEW: Field "image" di meals adalah optional - bisa URL atau local path
✓ NEW: Image field akan di-return di response create meal dan get statistics================================================================================
                            ERROR HANDLING
================================================================================

401 UNAUTHORIZED
Response: 
{
  "success": false,
  "message": "Unauthorized",
  "statusCode": 401
}
Action: Pastikan token di Authorization header benar dan belum expired

400 BAD REQUEST (Date Format)
Response:
{
  "success": false,
  "message": "Invalid date format. Use YYYY-MM-DD",
  "statusCode": 400
}
Action: Gunakan format YYYY-MM-DD di parameter date
Contoh: /nutritions/2025-12-01

404 NOT FOUND (No Data for Date)
Response:
{
  "success": true,
  "message": "No nutrition data found for this date",
  "responseObject": null,
  "statusCode": 200
}
Action: Tidak ada data meal untuk tanggal tersebut, buat meal terlebih dahulu

413 PAYLOAD TOO LARGE
Action: File gambar terlalu besar, max 5MB

415 UNSUPPORTED MEDIA TYPE
Action: Format gambar harus JPEG atau PNG

================================================================================

Generated: 1 December 2025
Status: Ready for Production Testing
Updated: New endpoints - POST /nutritions/meals & GET /nutritions/:date

================================================================================

